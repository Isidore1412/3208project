version: "3.3"

services:
        db:
                image: mariadb:latest
                restart: always
                environment:
                        MYSQL_ROOT_PASSWORD: Root123
                        MYSQL_DATABASE: project
                        MYSQL_USER: pro
                        MYSQL_PASSWORD: pro
                ports: 
                        - 3306:3306
                networks:
                        - myproject
        
        redis:
                image: redis:latest
                restart: always
                ports: 
                        - 6379:6379
                networks:
                        - myproject
        
        nodejs:
                image: node:latest
                user: "node"
                restart: always
                working_dir: /home/node/app
                environment:
                        - NODE_ENV=production
                volumes:
                        - ./nodejs/app:/home/node/app
                ports:  
                        - 8888:8888
                networks:
                        - myproject
                command: bash -c "npm start && npm install -g pm2 --no-install-recommends --no-install-suggests"

        nginx:
                image: nginx:latest
                restart: always
                volumes:
                        - $HOME/3208project/src:/var/www/html
                        - $HOME/3208project/nginx.ini:/etc/nginx/conf.d/default.conf
                depends_on:
                        - db
                        - redis
                        - nodejs
                ports:
                        - 80:80
                networks:
                        -  myproject
        
networks:
        myproject: